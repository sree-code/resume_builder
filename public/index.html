<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Resume ATS Analyzer</title>
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <main class="app-shell">
      <section class="hero">
        <p class="eyebrow">Resume Analyzer</p>
        <h1>ATS-style Job Match + AI Resume Optimization</h1>
        <p class="subtle">
          Paste a job description and your resume text (or upload a file). The app scores alignment and suggests changes.
        </p>
      </section>

      <section class="panel form-panel">
        <form id="analyzer-form">
          <div class="field">
            <div class="field-head">
              <label for="jobDescription">Job Description</label>
              <button type="button" id="clearJobBtn" class="secondary small">Clear</button>
            </div>
            <textarea id="jobDescription" name="jobDescription" placeholder="Paste the job description here..." required></textarea>
          </div>

          <div class="grid two">
            <div class="field">
              <div class="field-head">
                <label for="resumeText">Resume Text</label>
                <button type="button" id="clearResumeBtn" class="secondary small">Clear</button>
              </div>
              <textarea id="resumeText" name="resumeText" placeholder="Paste resume text here (or upload a file below)..."></textarea>
            </div>

            <div class="field">
              <label for="resumeFile">Resume File (optional)</label>
              <input id="resumeFile" name="resumeFile" type="file" accept=".txt,.docx,.pdf" />
              <p class="hint">Supported: TXT, DOCX, PDF (PDF parsing depends on local Node compatibility).</p>

              <div class="tips-card">
                <h3>How to improve score</h3>
                <ul>
                  <li>Mirror exact skills/keywords from the JD (truthfully).</li>
                  <li>Use ATS-friendly headings: Summary, Skills, Experience, Education.</li>
                  <li>Write quantified bullet points with impact metrics.</li>
                  <li>Avoid tables/graphics/icons in the resume source.</li>
                </ul>
              </div>
            </div>
          </div>

          <div class="actions">
            <button type="submit" id="analyzeBtn">Analyze Match</button>
            <button type="button" id="optimizeAllBtn" class="secondary">Analyze + Optimize</button>
          </div>
          <div class="grid two compact-grid">
            <label class="toggle-option">
              <span>
                <strong>Optimization Preset</strong>
                <small>Tune keyword extraction/scoring/proposal generation for a target role profile.</small>
              </span>
              <select id="rolePreset" name="rolePreset">
                <option value="general" selected>General Sr Software Engineer</option>
                <option value="mobile_release">Mobile Release / Release Engineering</option>
              </select>
            </label>
            <label class="toggle-option">
              <input type="checkbox" id="advancedAtsMode" name="advancedAtsMode" checked />
              <span>
                <strong>Advanced ATS Mode (Beta)</strong>
                <small>Improved keyword extraction/grouping and deeper proposal generation. Turn off to compare baseline scoring.</small>
              </span>
            </label>
            <label class="toggle-option">
              <input type="checkbox" id="aggressivePersonalMode" name="aggressivePersonalMode" checked />
              <span>
                <strong>Aggressive Personal Mode</strong>
                <small>Equivalence-friendly scoring for personal ATS optimization (still avoids fabrication).</small>
              </span>
            </label>
            <label class="toggle-option">
              <input type="checkbox" id="jdKeywordListMode" name="jdKeywordListMode" />
              <span>
                <strong>Keyword-List JD Mode</strong>
                <small>Use this when you paste raw keywords/phrases instead of a full job description.</small>
              </span>
            </label>
            <label class="toggle-option">
              <input type="checkbox" id="aggressiveFileContentMode" name="aggressiveFileContentMode" />
              <span>
                <strong>Aggressive ATS Content Mode (DOCX Beta)</strong>
                <small>For DOCX uploads, inserts approved new points as real paragraphs for higher ATS lift. Layout/page breaks may shift. PDF still uses strict mode.</small>
              </span>
            </label>
          </div>
          <div id="loaderCard" class="loader-card" hidden>
            <div class="loader-top">
              <div class="spinner-orb" aria-hidden="true"></div>
              <div>
                <p id="loaderTitle" class="loader-title">Working on your resume...</p>
                <p id="loaderSubtitle" class="hint">Analyzing keywords and preparing suggestions.</p>
              </div>
            </div>
            <div class="progress-track" aria-hidden="true">
              <div id="progressFill" class="progress-fill"></div>
            </div>
            <div class="progress-meta">
              <span id="progressPercent">0%</span>
              <span id="progressStep">Queued</span>
            </div>
          </div>
          <p id="statusText" class="status"></p>
          <div id="errorCard" class="error-card" hidden>
            <p class="error-title">Request Error</p>
            <pre id="errorDetails" class="error-details"></pre>
          </div>
        </form>
      </section>

      <section class="panel results-panel" id="resultsPanel" hidden>
        <div class="score-strip">
          <div class="score-card">
            <p class="score-label" id="scoreLabel">Simulated ATS Match</p>
            <p class="score-inline-change" id="scoreInlineChange" hidden></p>
            <p class="score-value"><span id="scoreValue">0</span><span class="percent">/100</span></p>
            <p class="score-band" id="scoreBand">-</p>
          </div>
          <div class="score-meta">
            <p id="disclaimerText" class="disclaimer"></p>
            <div id="breakdown" class="breakdown"></div>
          </div>
        </div>

        <div class="grid two results-grid" id="scoreCompareGrid" hidden>
          <div class="result-card">
            <h3>ATS Score: Before vs After</h3>
            <div class="score-compare">
              <div class="mini-score">
                <span>Before</span>
                <strong id="beforeScoreValue">0</strong>
              </div>
              <div class="mini-score">
                <span>After</span>
                <strong id="afterScoreValue">0</strong>
              </div>
              <div class="mini-score delta">
                <span>Delta</span>
                <strong id="deltaScoreValue">+0</strong>
              </div>
            </div>
          </div>
          <div class="result-card">
            <h3>Keyword Adds Preview</h3>
            <ul id="keywordAddPreview" class="list compact"></ul>
          </div>
        </div>

        <div class="grid two results-grid">
          <div class="result-card">
            <h3>Missing Keywords</h3>
            <div id="missingKeywords" class="chips"></div>
          </div>
          <div class="result-card">
            <h3>Matched Keywords</h3>
            <div id="matchedKeywords" class="chips"></div>
          </div>
        </div>

        <div class="grid two results-grid">
          <div class="result-card">
            <h3>Action Plan</h3>
            <ul id="suggestionsList" class="list"></ul>
          </div>
          <div class="result-card">
            <h3>ATS/Formatting Notes</h3>
            <ul id="formatNotes" class="list"></ul>
          </div>
        </div>

        <div class="result-card" id="optimizedCard" hidden>
          <div class="card-head">
            <h3>Optimized Resume Draft</h3>
            <button type="button" id="copyOptimizedBtn" class="secondary small">Copy</button>
          </div>
          <p id="optimizationMode" class="hint"></p>
          <p class="hint">This mode preserves the resume text structure (headings/order/line layout) and rewrites only eligible bullets/summary/skills lines.</p>
          <ul id="optimizationNotes" class="list compact"></ul>
          <textarea id="optimizedResumeOutput" readonly></textarea>
        </div>

        <div class="result-card" id="proposalReviewCard" hidden>
          <div class="card-head">
            <h3>Review Generated Resume Changes</h3>
            <div class="proposal-bulk-actions">
              <button type="button" id="selectAllProposalsBtn" class="secondary small">Select All</button>
              <button type="button" id="deselectAllProposalsBtn" class="secondary small">Deselect All</button>
            </div>
          </div>
          <p id="proposalReviewSummary" class="hint">
            Review the generated summary/experience/skills updates. Approve only the points that match your actual experience.
          </p>
          <div id="proposalList" class="proposal-list"></div>
          <div class="proposal-footer">
            <button type="button" id="applySelectedBtn">Apply Selected Changes</button>
            <p id="proposalSelectionMeta" class="hint">0 selected</p>
          </div>
        </div>

        <div class="result-card" id="downloadCard" hidden>
          <h3>Optimized File Download</h3>
          <p class="hint" id="downloadHint">Format-preserving file output will appear here.</p>
          <div class="download-actions">
            <a id="downloadDocxLink" class="download-link" href="#" download hidden>Download DOCX</a>
            <a id="downloadPdfLink" class="download-link" href="#" download hidden>Download PDF</a>
            <a id="downloadTxtLink" class="download-link" href="#" download hidden>Download TXT</a>
          </div>
        </div>

        <div class="result-card" id="changesCard" hidden>
          <h3>Changed Lines Preview</h3>
          <div id="changesPreview" class="changes-preview"></div>
        </div>
      </section>
    </main>

    <script src="/app.js"></script>
  </body>
  </html>
